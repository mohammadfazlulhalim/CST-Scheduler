<h1>{{title}}</h1>
{{#if instructorList}}
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Instructor Number</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Actions</th>
        </tr>
        </thead>
        <!--Here is where I loop through my array object and add in a <tr> for each loop, and a <td> for each object-->
        <tbody >
        {{#each instructorList}}
            <tr>
                <td id="{{this.instructorID}}number">{{this.instructorID}}</td>
                <td id="{{this.instructorID}}firstName">{{this.firstName}}</td>
                <td id="{{this.instructorID}}lastName">{{this.lastName}}</td>

                <td>
                    <button id="{{this.instructorID}}edit" type="button" class="btn btn-primary editButton" data-toggle="modal" data-target="#editModal">Edit</button>
                    <button id="{{this.instructorID}}delete" type="button" class="btn btn-danger deleteButton" data-toggle="modal" data-target="#deleteModal">Delete</button>
                </td>
            </tr>
        {{/each}}
        </tbody>

    </table>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" role="dialog" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">Delete Instructor</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/instructor" method="POST">
                    <div class="modal-body">
                        <p>Are you sure you want to delete this instructor?</p>
                    </div>

                    <input type="text" id="deleteID" name="id" hidden />

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" id="deleteInstructor" class="btn btn-outline-danger">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" role="dialog" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Existing Instructor</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/instructor" method="POST">
                    <div class="modal-body">
                        <label hidden for="eInstructorID">Instructor Number:</label>
                        <input hidden type="number" class="form-control {{#if putErr.instructorID}}is-invalid{{/if}}" id="eInstructorID"
                               name="instructorID" value="{{putSubmittedInstructor.instructorID}}">
                        <div class="invalid-feedback">{{putErr.instructorID}}</div>

                        <label for="eFirstName">First Name:</label>
                        <input type="text" class="form-control {{#if putErr.firstName}}is-invalid{{/if}}" id="eFirstName"
                               name="firstName" value="{{putSubmittedInstructor.firstName}}">
                        <div class="invalid-feedback">{{putErr.firstName}}</div>


                        <label for="eLastName">Last Name:</label>
                        <input type="text" class="form-control {{#if putErr.lastName}}is-invalid{{/if}}" id="eLastName"
                               name="lastName" value="{{putSubmittedInstructor.lastName}}">
                        <div class="invalid-feedback">{{putErr.lastName}}</div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" id="editInstructor" class="btn btn-outline-success">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>



{{else}}
    <p>There are no instructors stored</p>
{{/if}}

<button type="button" class="btn btn-outline-success" data-toggle="modal" data-target="#addModal">New</button>

<!-- Add Modal - must be displayed even if no terms exist -->
<div class="modal fade" id="addModal" role="dialog" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">Create New Instructor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="/instructor" method="POST">
                <div class="modal-body">
                    <label for="cInstructorID">Instructor Number:</label>
                    <input type="number" class="form-control {{#if err.instructorID}}is-invalid{{/if}}" id="cInstructorID"
                           name="instructorID" value="{{submittedInstructor.instructorID}}">
                    <div class="invalid-feedback">{{err.instructorID}}</div>

                    <label for="cFirstName">First Name:</label>
                    <input type="text" class="form-control {{#if err.firstName}}is-invalid{{/if}}" id="cFirstName"
                           name="firstName" value="{{submittedInstructor.firstName}}">
                    <div class="invalid-feedback">{{err.firstName}}</div>

                    <label for="cLastName">Last Name:</label>
                    <input type="text" class="form-control {{#if err.lastName}}is-invalid{{/if}}" id="cLastName"
                           name="lastName" value="{{submittedInstructor.lastName}}">
                    <div class="invalid-feedback">{{err.lastName}}</div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" id="createInstructor" class="btn btn-outline-success">Create</button>
                </div>
            </form>
        </div>
    </div>
</div>

<a href="http://localhost:3000/administration"><button class="btn btn-success">Go Back</button></a>

<!-- My own handlers for the form submits -->
<script>
    "use strict";

    reLinkButtons();

    /**
     * This function links the buttons on the page to their appropriate handlers
     */
    function reLinkButtons() {
        $("#createInstructor").click(handleCreateInstructor);
        $("#deleteInstructor").click(handleDeleteInstructor);
        $("#editInstructor").click(handleEditInstructor);
        $(".deleteButton").click(function () {
            handleDeleteModal(this.id.replace("delete", ""));
        });
        $(".editButton").click(function () {
            handleEditModal(this.id.replace("edit", ""))
        });
    }

    /**
     * This function handles what happens when a user clicks the "create" button
     * in the Create New Instructor modal
     * @returns {Promise<void>}
     */
    async function handleCreateInstructor() {
        // send a POST request to the router
        const response = await fetch("http://localhost:3000/instructor", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // use the val() method to get the value of a form input
                instructorID: $("#cInstructorID").val(),
                firstName: $("#cFirstName").val(),
                lastName: $("#cLastName").val(),
            }),
        });

        // get the HTML text response
        const data = await response.text();
        const modal = "#addModal";

        loadResponse(modal, data, !response.ok);
    }

    /**
     * This function handles what happens when a user clicks the "Delete" button
     * in the Delete Instructor modal
     * @returns {Promise<void>}
     */
    async function handleDeleteInstructor() {
        // send a DELETE request to the router
        const response = await fetch("http://localhost:3000/instructor", {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // use the val() method to get the value of a form input
                instructorID: $("#deleteInstructor").val(),
            }),
        });

        // get the HTML text response
        const data = await response.text();
        const modal = "#deleteModal";

        loadResponse(modal, data, !response.ok);
    }

    /**
     * This function handles what happens when a user clicks the "Save" button
     * in the Edit Existing Instructor modal
     * @returns {Promise<void>}
     */
    async function handleEditInstructor() {
        const id = $("#editID").val();
        // send a PUT request to the router
        const response = await fetch("http://localhost:3000/instructor", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // use the val() method to get the value of a form input
                instructorID: $("#eInstructorID").val(),
                firstName: $("#eFirstName").val(),
                lastName: $("#eLastName").val(),
            }),
        });

        // get the HTML text response
        const data = await response.text();
        const modal = "#editModal";

        loadResponse(modal, data, !response.ok);
    }

    /**
     * This function loads a hidden form input in the delete modal with the ID of the term to delete
     * @param idToDelete    - The ID of the term to delete
     */
    function handleDeleteModal(idToDelete) {
        $("#deleteInstructor").val(idToDelete);
    }

    /**
     * This function loads the form in the Edit Existing Instructor modal with the information
     * of the term the user wants to edit
     * @param idToEdit    - The ID of the term being edited
     */
    function handleEditModal(idToEdit) {
        $("#eInstructorID").val($(`#${idToEdit}number`).text());
        $("#eFirstName").val($(`#${idToEdit}firstName`).text());
        $("#eLastName").val($(`#${idToEdit}lastName`).text());
    }

    /**
     * As the server gives responses in HTML, the client needs to be able to parse that data.
     * This function replaces the HTML of the current page with the new HTML from the server
     * and pops up the last used modal if there were errors.
     * @param modalID   - The HTML id of the modal to pop up
     * @param data      - The HTML response from the server
     * @param showModal - True to show the modal, false to hide the modal
     */
    function loadResponse(modalID, data, showModal) {
        // set the whole document's HTML to be the response
        document.documentElement.innerHTML = data;
        // re-add the click handlers
        reLinkButtons();
        // refresh the modal
        const modal = $(modalID);
        modal.modal("hide");

        // if the response was not ok, pop up the modal
        if (showModal) {
            modal.modal("show");
        }
    }
</script>

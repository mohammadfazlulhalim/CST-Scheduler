<!--find classroom conflict modal   -->
<div id="classroomReportInfoModal" class="modal fade" tabindex="-1" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Find Classroom conflicts </h5>
                <button id="xBtn" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="#" class="mb-3">
                    <div class="mb-3">
                        <label for="termSelect" class="form-label">Term:</label>
                        <select id="termSelect" name="term" class="form-select">
                            <option value="" selected disabled>Select Term</option>
                            {{#each terms}}
                                <option value="{{this.id}}">{{this.startDate}} - {{this.termNumber}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="classroomSelect" class="form-label">Classroom:</label>
                        <select id="classroomSelect" name="classroom" class="form-select">
                            <option value="" selected disabled>Select Classroom</option>
                            {{#each classrooms}}
                                <option value="{{this.id}}">{{this.roomNumber}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button id="modalCloseBtn" type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button id="btnGenerateReport"
                                type="submit" class="btn btn-outline-success" disabled>Generate Report
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{{#if timeslotsReturned}}
<div>
    <div class="row">
        <div class="col-9">
            <h2><i>Classroom:</i> {{realClassroom.roomNumber}}</h2>
        </div>
        <div class="col-9">
            <h2><i>Term:</i>{{realTerm.termNumber}} {{realTerm.startDate}}</h2>
        </div>
    </div>
</div>

<div class="p-4">
    <table class="table table-striped">
            <tr> {{#each headerArray}}
                <th>{{this.header}} </th>
            {{/each}}
            </tr>

        {{#each timeslotsReturned}}
            {{#each this}}
            <tr>
                <td>{{this.Term.termNumber}} {{this.Term.startDate}}</td>
                <td>{{this.CourseOffering.Course.courseCode}}</td>
                <td>{{this.day}}</td>
                <td>{{this.startTime}}</td>
                <td>{{this.endTime}}</td>
                <td>{{this.Instructor.firstName}} {{this.Instructor.lastName}}</td>
            </tr>
        {{/each}}
            {{/each}}
    </table>
</div>
{{else}}
    <h1 id="nothingToShow">Nothing to display at the moment</h1>
{{/if}}

<!-- New report and print buttons -->
<div class="btnPairsCustom">
    <button id="newReportBtn" type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#classroomReportInfoModal">
        New Report</button>
    <button id="printRptBtn" class="btn btn-outline-success" onclick="printReport()">Print this page</button>
</div>


<script>

    'use strict';

    window.onload = function() {
        const modal = new bootstrap.Modal(document.getElementById('classroomReportInfoModal'));


        let termSelect = document.getElementById('termSelect');
        let classroomSelect = document.getElementById('classroomSelect');

        let submitBtn = document.getElementById('btnGenerateReport');
        let closeBtn = document.getElementById('modalCloseBtn');
        let xBtn =document.getElementById('xBtn');
        let newReportBtn=document.getElementById('newReportBtn');


        {{#if showModal}}
            // check if the "close" button was clicked
            closeBtn.addEventListener("click", function () {
                modal.hide();
            });
            // check if the 'x' button was clicked
            xBtn.addEventListener("click", function () {
                modal.hide();
            });
            modal.show();

        {{/if}}

        // check if the "new report" button was clicked
        newReportBtn.addEventListener("click", function () {
            modal.show();
        });
        // Add event listeners to the selects
        termSelect.addEventListener('change', handleSelectChange);
        classroomSelect.addEventListener('change', handleSelectChange);

        function handleSelectChange() {
            // Enable or disable the submit button based on whether both selects have values
            submitBtn.disabled = termSelect.value === '' || classroomSelect.value === '';
        }
        function printReport() {
            const printWindow = window.open('', '_blank');

            // Add styles or additional content if needed
            printWindow.document.write('<html><head><title>Program Report</title>');
            printWindow.document.write('<style>');
            printWindow.document.write('@media print { @page { size: landscape; } }'); // Set page orientation to landscape
            printWindow.document.write('.table-bordered { border-collapse: collapse; width: 100%; }');
            printWindow.document.write('.table-bordered th, .table-bordered td { border: 1px solid black; padding: 8px; }');
            printWindow.document.write('</style>');
            printWindow.document.write('</head><body>');

            // Print date and name
            const dateGen = document.getElementById("dateGenDisplayer").innerText;
            const programName = document.getElementById("nameDisplayer").innerText;

            printWindow.document.write('<h2>Program Report For: ' + programName + '</h2>');
            printWindow.document.write('<p>Report Generated: ' + dateGen + '</p>');

            // Print the table
            const tableHtml = document.querySelector('.table-bordered').outerHTML;
            printWindow.document.write(tableHtml);

            printWindow.document.write('</body></html>');

            printWindow.document.close();
            printWindow.print();
        }
    };
</script>
